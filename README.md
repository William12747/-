# Retro2MP4 - Legacy Video Batch Converter

批量轉換舊影片格式為 MP4 的桌面應用程式。

## 功能特性

- ✅ 資料夾遞迴掃描（支援 flv/asf/rmvb/mpeg/mpg/wmv/avi 格式）
- ✅ 批次佇列與處理控制（開始/暫停/繼續/停止）
- ✅ 輸出到指定資料夾 + 保留資料夾結構
- ✅ 預設輸出：MP4 (H.264 + AAC) 相容優先
- ✅ 失敗顯示與匯出失敗清單
- ✅ 內建快速預覽播放（轉換完成後可預覽）

## 技術棧

- **前端**: React 18
- **桌面框架**: Electron
- **影片處理**: FFmpeg (透過 fluent-ffmpeg)

## 系統需求

- **macOS**: macOS 10.13 或更高版本
- **Windows**: Windows 10 或更高版本
- **Node.js**: 16.0 或更高版本
- **npm**: 8.0 或更高版本（或使用 yarn）

## 安裝與設定

### macOS 使用步驟

#### 步驟 1：安裝 Node.js

1. 前往 [Node.js 官網](https://nodejs.org/) 下載 macOS 安裝檔
2. 選擇 LTS 版本（建議版本）
3. 執行下載的 `.pkg` 檔案並按照安裝精靈完成安裝
4. 開啟「終端機」（Terminal）應用程式
5. 驗證安裝是否成功：
   ```bash
   node --version
   npm --version
   ```
   應該會顯示版本號碼

#### 步驟 2：下載專案

1. 將專案資料夾下載或複製到您想要的位置（例如：`~/Documents/轉檔工具`）
2. 開啟「終端機」應用程式
3. 使用 `cd` 指令進入專案資料夾：
   ```bash
   cd ~/Documents/轉檔工具
   ```

#### 步驟 3：安裝專案依賴

在終端機中執行：
```bash
npm install
```

這會自動下載並安裝所有必要的套件，包括：
- React 和相關前端套件
- Electron 桌面應用框架
- FFmpeg 靜態執行檔（用於影片轉換）

**注意**：首次安裝可能需要幾分鐘時間，請耐心等待。

#### 步驟 4：啟動應用程式

在終端機中執行：
```bash
npm run dev
```

這會：
1. 啟動 React 開發伺服器（在背景執行）
2. 自動開啟 Electron 應用程式視窗

**提示**：如果遇到「無法打開，因為它來自未識別的開發者」的錯誤：
1. 前往「系統偏好設定」>「安全性與隱私權」
2. 點擊「仍要打開」按鈕
3. 或者，在終端機中執行：
   ```bash
   sudo spctl --master-disable
   ```

### Windows 使用步驟

#### 步驟 1：安裝 Node.js

1. 前往 [Node.js 官網](https://nodejs.org/) 下載 Windows 安裝檔
2. 選擇 LTS 版本（建議版本）
3. 執行下載的 `.msi` 檔案並按照安裝精靈完成安裝
   - 安裝時請勾選「Add to PATH」選項
4. 開啟「命令提示字元」（CMD）或「PowerShell」
   - 按 `Win + R`，輸入 `cmd` 或 `powershell`，按 Enter
5. 驗證安裝是否成功：
   ```bash
   node --version
   npm --version
   ```
   應該會顯示版本號碼

#### 步驟 2：下載專案

1. 將專案資料夾下載或複製到您想要的位置（例如：`C:\Users\您的使用者名稱\Documents\轉檔工具`）
2. 開啟「命令提示字元」或「PowerShell」
3. 使用 `cd` 指令進入專案資料夾：
   ```bash
   cd C:\Users\您的使用者名稱\Documents\轉檔工具
   ```
   或使用檔案總管：
   - 在專案資料夾中，按住 `Shift` 鍵並右鍵點擊空白處
   - 選擇「在此處開啟 PowerShell 視窗」或「在此處開啟命令視窗」

#### 步驟 3：安裝專案依賴

在命令提示字元或 PowerShell 中執行：
```bash
npm install
```

這會自動下載並安裝所有必要的套件，包括：
- React 和相關前端套件
- Electron 桌面應用框架
- FFmpeg 靜態執行檔（用於影片轉換）

**注意**：
- 首次安裝可能需要幾分鐘時間，請耐心等待
- 如果遇到權限問題，請以系統管理員身分執行命令提示字元
- 某些防毒軟體可能會警告，這是正常現象，請允許執行

#### 步驟 4：啟動應用程式

在命令提示字元或 PowerShell 中執行：
```bash
npm run dev
```

這會：
1. 啟動 React 開發伺服器（在背景執行）
2. 自動開啟 Electron 應用程式視窗

**提示**：如果 Windows Defender 或防毒軟體阻擋，請將專案資料夾加入例外清單。

## 使用說明

### 基本操作流程

#### 步驟 1：選擇輸入資料夾

1. 在應用程式視窗中，找到「輸入資料夾」區域
2. 點擊「選擇資料夾」按鈕
3. 在檔案選擇對話框中，選擇包含舊影片格式的資料夾
4. 選擇的資料夾路徑會顯示在按鈕下方

#### 步驟 2：掃描影片檔案

1. 點擊「掃描影片檔案」按鈕
2. 系統會遞迴掃描所選資料夾及其所有子資料夾
3. 掃描過程中會顯示「掃描中...」狀態
4. 掃描完成後，會顯示找到的影片檔案數量
5. 所有找到的檔案會自動加入轉換佇列

#### 步驟 3：選擇輸出資料夾

1. 在「輸出資料夾」區域，點擊「選擇資料夾」按鈕
2. 選擇轉換後影片的儲存位置
3. **重要**：系統會自動保留原始資料夾結構
   - 例如：如果輸入是 `影片/舊檔/影片1.avi`
   - 輸出會是 `輸出資料夾/影片/舊檔/影片1.mp4`

#### 步驟 4：開始轉換

1. 確認已選擇輸入和輸出資料夾
2. 點擊「開始轉換」按鈕
3. 系統會按照佇列順序處理所有檔案
4. 每個檔案會顯示：
   - 當前狀態（等待中/處理中/已完成/失敗）
   - 轉換進度百分比
   - 處理時間資訊

#### 步驟 5：控制轉換過程

在轉換過程中，您可以：

- **暫停**：點擊「暫停」按鈕暫時停止轉換（當前檔案完成後暫停）
- **繼續**：點擊「繼續」按鈕恢復轉換
- **停止**：點擊「停止」按鈕完全停止轉換（當前檔案會標記為失敗）

#### 步驟 6：預覽轉換結果

1. 轉換完成後，檔案狀態會變為「已完成」
2. 點擊檔案旁邊的「👁️ 預覽」按鈕
3. 會在彈出視窗中播放轉換後的影片
4. 可以檢查影片和音訊是否正常

#### 步驟 7：處理失敗檔案

1. 如果有轉換失敗的檔案，會顯示在「失敗檔案」區域
2. 每個失敗檔案會顯示錯誤訊息
3. 點擊「📥 匯出失敗清單」按鈕
4. 會下載一個文字檔，包含所有失敗檔案的詳細資訊
5. 可以根據錯誤訊息進行排查

### 統計資訊

在控制面板中，您可以即時查看：

- **總計**：佇列中的總檔案數
- **已完成**：成功轉換的檔案數（綠色顯示）
- **處理中**：當前正在處理的檔案數（藍色顯示）
- **失敗**：轉換失敗的檔案數（紅色顯示）

## 專案結構

```
轉檔工具/
├── electron/              # Electron 主進程程式碼
│   ├── main.js           # 主進程入口
│   ├── preload.js        # 預載入腳本（橋接）
│   └── videoProcessor.js # 影片處理邏輯
├── src/                  # React 前端程式碼
│   ├── components/       # React 元件
│   │   ├── FolderSelector.js    # 資料夾選擇器
│   │   ├── QueueList.js          # 佇列列表
│   │   ├── ControlPanel.js       # 控制面板
│   │   ├── PreviewPlayer.js      # 預覽播放器
│   │   └── FailedList.js         # 失敗清單
│   ├── App.js            # 主應用元件
│   └── index.js          # 入口檔案
├── public/               # 靜態資源
├── package.json          # 專案設定
└── README.md            # 本檔案
```

## 支援的輸入格式

- **FLV** - Flash Video
- **ASF** - Advanced Systems Format
- **RMVB** - RealMedia Variable Bitrate
- **MPEG/MPG** - Moving Picture Experts Group
- **WMV** - Windows Media Video
- **AVI** - Audio Video Interleave

## 輸出格式

- **容器格式**: MP4
- **影片編碼**: H.264 (libx264)
- **音訊編碼**: AAC
- **品質設定**: CRF 23（平衡品質與檔案大小）
- **相容性**: 可在 QuickTime (macOS) 和 Windows Media Player 正常播放

## 常見問題

### Q: 轉換速度很慢？

**A**: 轉換速度取決於多個因素：
- 影片檔案大小和解析度
- 系統 CPU 效能
- 硬碟讀寫速度
- 可以暫停/繼續來控制處理節奏

### Q: 某些檔案轉換失敗？

**A**: 常見原因和解決方法：
- **檔案損壞**：原始檔案可能已損壞，無法修復
- **不支援的編碼格式**：某些特殊編碼可能無法轉換
- **磁碟空間不足**：確保輸出資料夾有足夠空間
- **權限問題**：確保對輸入和輸出資料夾有讀寫權限
- 查看失敗清單中的錯誤訊息以獲得更多資訊

### Q: 如何處理大量檔案？

**A**: 
- 系統支援遞迴掃描子資料夾，會自動處理所有支援的影片檔案
- 建議先測試少量檔案，確認轉換結果符合需求
- 可以分批處理，先處理一部分，確認無誤後再處理其他檔案

### Q: 轉換後的檔案比原始檔案大？

**A**: 這是正常現象，因為：
- H.264 編碼會根據內容複雜度調整檔案大小
- CRF 23 設定會優先保證品質
- 如果原始檔案使用較低品質編碼，轉換後檔案可能會變大

### Q: 可以在轉換過程中關閉應用程式嗎？

**A**: 不建議。如果關閉應用程式，正在轉換的檔案可能會失敗。建議：
- 等待當前批次完成
- 或先暫停，稍後再繼續

### Q: macOS 上出現安全性警告？

**A**: 
1. 前往「系統偏好設定」>「安全性與隱私權」
2. 點擊「仍要打開」
3. 或使用終端機執行：`sudo spctl --master-disable`（不建議，會降低系統安全性）

### Q: Windows 上防毒軟體阻擋？

**A**: 
1. 將專案資料夾加入防毒軟體例外清單
2. 或暫時停用即時防護（不建議）
3. Electron 應用程式有時會被誤判，這是正常現象

## 注意事項

- ⚠️ **首次執行**：需要下載 FFmpeg 靜態檔案（透過 ffmpeg-static 套件），可能需要一些時間
- ⚠️ **磁碟空間**：確保有足夠的磁碟空間儲存轉換後的檔案
- ⚠️ **備份建議**：轉換前建議先備份原始檔案
- ⚠️ **大量檔案**：處理大量檔案時，建議分批進行，避免系統負載過高
- ⚠️ **網路連線**：首次安裝需要網路連線下載依賴套件

## 建置生產版本

如果您想要建置可執行的應用程式檔案：

### macOS

```bash
npm run build
npm run build:electron
```

建置完成後，可在 `dist` 資料夾中找到 `.app` 檔案。

### Windows

```bash
npm run build
npm run build:electron
```

建置完成後，可在 `dist` 資料夾中找到 `.exe` 安裝檔。

## 授權

MIT License

## 技術支援

如遇到問題，請檢查：
1. Node.js 版本是否符合需求
2. 所有依賴套件是否正確安裝
3. 系統權限是否足夠
4. 磁碟空間是否充足

---

**祝您使用愉快！** 🎬
